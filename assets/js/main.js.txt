(function () {
  const modal = document.getElementById("zipModal");
  const openBtns = document.querySelectorAll("[data-open-zip]");
  const closeBtns = document.querySelectorAll("[data-close-zip]");

  const form = document.getElementById("zipForm");
  const zipInput = document.getElementById("zipInput");
  const zipError = document.getElementById("zipError");

  const success = document.getElementById("zipSuccess");

  function openModal() {
    if (!modal) return;
    modal.classList.add("is-open");
    modal.setAttribute("aria-hidden", "false");
    zipError.textContent = "";
    if (success) success.hidden = true;
    if (form) form.hidden = false;
    setTimeout(() => zipInput && zipInput.focus(), 50);
  }

  function closeModal() {
    if (!modal) return;
    modal.classList.remove("is-open");
    modal.setAttribute("aria-hidden", "true");
  }

  openBtns.forEach(btn => btn.addEventListener("click", openModal));
  closeBtns.forEach(btn => btn.addEventListener("click", closeModal));

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeModal();
  });

  function isValidZip(zip) {
    const z = String(zip || "").trim();
    return /^[0-9]{5}(?:-[0-9]{4})?$/.test(z);
  }

  if (form) {
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const zip = zipInput ? zipInput.value : "";
      if (!isValidZip(zip)) {
        zipError.textContent = "Please enter a valid ZIP code.";
        return;
      }

      zipError.textContent = "";

      // TODO: connect to your flow:
      // 1) redirect: window.location.href = "/step2.html?zip=" + encodeURIComponent(zip);
      // 2) webhook: fetch("YOUR_ENDPOINT", { method:"POST", headers:{...}, body: JSON.stringify({ zip }) })
      // 3) Netlify Forms: use a real <form name="..."> and let Netlify capture it

      if (form) form.hidden = true;
      if (success) success.hidden = false;
    });
  }
})();
